var data;async function fetchData(){try{null==(data=JSON.parse(localStorage.getItem("data")))&&(data=await fetchAllDummyJSON(),localStorage.setItem("data",JSON.stringify(data)))}catch(e){throw console.error("Error while fetching: "+e+" Rethrowing to fetchData."),e}}async function fetchAllDummyJSON(){try{const[e,t,n]=await Promise.all([fetch("https://dummyjson.com/users?limit=0"),fetch("https://dummyjson.com/posts?limit=0"),fetch("https://dummyjson.com/comments?limit=0")]);if(!e.ok)throw new Error("Failed to fetch users");if(!t.ok)throw new Error("Failed to fetch posts");if(!n.ok)throw new Error("Failed to fetch comments");console.log("Data fetched from DummyJSON API.");const o=await e.json(),a=await t.json(),s=await n.json();return{users:o.users,posts:a.posts,comments:s.comments}}catch(e){throw console.error("Error while fetching data from DummyJSON API: "+e),e}}function getCommentsForPost(e){return data.comments.filter((t=>t.postId==e))}function renderNewPostForm(){try{const e=document.getElementById("main-content");e.innerHTML="";const t=document.createElement("article"),n=document.createElement("form");n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"title",textContent:"Title:"}));const o=document.createElement("input");o.type="text",o.id="title",o.name="title",o.required=!0,n.appendChild(o),n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"body",textContent:"Message:"}));const a=document.createElement("textarea");a.id="body",a.name="body",a.required=!0,n.appendChild(a),n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"tags",textContent:"Tags:"})),n.appendChild(Object.assign(document.createElement("input"),{type:"text",id:"tags",name:"tags",required:!0})),n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"user",textContent:"Posting user:"}));const s=document.createElement("select");s.id="userId",data.users.forEach((e=>{s.appendChild(Object.assign(document.createElement("option"),{value:e.id,textContent:e.username}))})),n.appendChild(s);const d=document.createElement("button");d.type="submit",d.textContent="Submit",n.appendChild(d),t.appendChild(n),e.appendChild(t),n.addEventListener("submit",submitAddPostFormData)}catch(e){throw console.error("Error while rendering user form: "+e+" Rethrowing to caller."),e}}function getAddCommentForm(e){try{const t=document.createElement("article"),n=document.createElement("form");n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"commentBody",textContent:"Comment:"}));const o=document.createElement("input");o.id="postId",o.value=e,o.type="hidden",n.appendChild(o);const a=document.createElement("textarea");a.id="commentBody",a.name="commentBody",a.required=!0,n.appendChild(a),n.appendChild(Object.assign(document.createElement("label"),{htmlFor:"user",textContent:"Posting user:"}));const s=document.createElement("select");s.id="userId",data.users.forEach((e=>{s.appendChild(Object.assign(document.createElement("option"),{value:e.id,textContent:e.username}))})),n.appendChild(s);const d=document.createElement("button");return d.type="submit",d.textContent="Submit",n.appendChild(d),t.appendChild(n),n.addEventListener("submit",submitAddCommentFormData),t}catch(e){throw console.error("Error while rendering user form: "+e+" Rethrowing to caller."),e}}function renderPosts(){const e=document.getElementById("main-content");e.innerHTML="",data.posts.forEach((t=>{let n=t.body.slice(0,60);const o=n.lastIndexOf(" ");o>40&&(n=n.slice(0,o)),n="<p>"+n+"..</p>";const a="<h2>"+t.title+"</h2>",s="<p>"+t.tags+"</p",d="<p><b> - "+data.users.filter((e=>e.id==t.userId))[0].username+"</b></p>",r=document.createElement("article");r.className="postPreview",r.id="post"+t.id,r.innerHTML=a+n+s+d,r.addEventListener("click",(()=>{renderPost(t)})),r.tabIndex="0",r.addEventListener("keydown",(e=>{"Enter"===e.key&&renderPost(t)})),e.appendChild(r)}))}function renderPost(e){const t=document.getElementById("main-content");t.innerHTML="";const n=data.users.filter((t=>t.id==e.userId))[0].username,o=document.createElement("article");o.append(Object.assign(document.createElement("h2"),{textContent:e.title}),Object.assign(document.createElement("p"),{textContent:e.body}),Object.assign(document.createElement("p"),{textContent:e.tags}),Object.assign(document.createElement("b"),{innerHTML:"<b>"+n+"</b>"}));const a=Object.assign(document.createElement("p"),{textContent:e.reactions.likes});a.appendChild(Object.assign(document.createElement("div"),{className:"react",textContent:"‚ù§Ô∏è"})),a.addEventListener("click",(()=>{e.reactions.likes++,a.textContent=e.reactions.likes+"‚ù§Ô∏è"}));const s=Object.assign(document.createElement("p"),{className:"react",textContent:e.reactions.dislikes+"üí©"});s.addEventListener("click",(()=>{e.reactions.dislikes++,s.textContent=e.reactions.dislikes+"üí©"})),o.append(a,s),o.className="post",t.appendChild(o);const d=getCommentsForPost(e.id),r=document.createElement("article");d.forEach((e=>{r.appendChild(showComment(e))})),r.hasChildNodes()&&t.appendChild(r),t.appendChild(getAddCommentForm(e.id))}function showComment(e){const t="<p>"+e.body+"<p>",n="<p>"+e.user.username+"<p>",o="<p>"+e.likes+"‚ù§Ô∏è<p>",a=document.createElement("p");return a.className="comment",a.innerHTML=t+n+o,a}function getUsername(e){return data.users.filter((t=>t.id==e))[0].username}function submitAddPostFormData(){let e;try{const t=document.getElementById("title").value,n=document.getElementById("body").value,o=document.getElementById("tags").value.split(/\s+/).map((e=>e.replace(/[^a-zA-Z0-9]/g,""))).filter((e=>e.length>0)),a=document.getElementById("userId").value;e={id:data.posts.reduce(((e,t)=>t.id>e?t.id:e),0)+1,title:t,body:n,tags:o,reactions:{likes:0,dislikes:0},views:0,userId:a},data.posts.push(e),localStorage.setItem("data",JSON.stringify(data)),console.log("Post successfully added:",e)}catch(e){console.error("Error adding post:",e)}finally{renderPost(e)}}function submitAddCommentFormData(){let e;try{const t=document.getElementById("commentBody").value,n=data.users.find((e=>e.id==document.getElementById("userId").value));e=document.getElementById("postId").value;const o=data.comments.reduce(((e,t)=>t.id>e?t.id:e),0)+1,a={id:n.id,fullName:n.firstName+" "+n.lastName,username:n.username};newComment={id:o,body:t,likes:0,postId:e,user:a},data.comments.push(newComment),localStorage.setItem("data",JSON.stringify(data)),console.log("Post successfully added:",newComment)}catch(e){console.error("Error adding post:",e)}finally{renderPost(data.posts.find((t=>t.id==e)))}}async function onPageLoad(){try{null==data&&await fetchData(),console.log(data),renderPosts()}catch(e){console.error("Error in fetchData:",e)}}onPageLoad();